# Testing

## Overview

The application has been tested in multiple ways. Automated tests has been written using [pytest](https://docs.pytest.org/en/7.1.x). A test coverage report can be generated with [coverage](https://coverage.readthedocs.io/en/6.5.0/). Performance testing has been conducted with a script utilizing [pytest-benchmark](https://github.com/ionelmc/pytest-benchmark). See a more detailed breakdown of testing below.

## Unit testing

### Running unit tests

```bash
# Tests can be run with the command
# Please be patient as it may take some time to finish
$ poetry run invoke test
```

### Test coverage

```bash
# Test coverage can be checked with the command
$ poetry run invoke coverage

# A test coverage report can be generated with the command
$ poetry run invoke coverage-report

# The coverage report can be viewed by opening it
# with a web browser, for example Mozilla Firefox
$ firefox htmlcov/index.html
```

#### Coverage report

Coverage report: 99%
*coverage.py v6.5.0, created at 2022-10-28 13:25 +0300*

| Module 	                 | statements |	missing | excluded | branches | partial | coverage |
| :------------------------- | ---------: | ------: | -------: | -------: | ------: | -------: |
| src/functions/crypt.py 	 |         32 |       0 |        0 |        8 |       0 |     100% |
| src/functions/keygen.py 	 |         69 |       1 |        0 |       16 |       1 |      98% |
| src/utils/character_map.py | 	       17 |       0 |        0 |        8 |       0 |     100% |
| **Total**                  |    **118** |   **1** |    **0** |   **32** |   **1** |  **99%** |

## Performance testing

Performance tests have been implemented in a separate module and they can be found in the file `src/performance.py`. The performance of the application is tested by comparing it to [another implementation](https://github.com/sybrenstuvel/python-rsa) with the same input parameters. The add-on [pytest-benchmark](https://pytest-benchmark.readthedocs.io/en/stable/index.html) is used for benchmarking.

### Running the performance test

```bash
# The performance test can be run with the following command
$ poetry run invoke performance-test
```

### Results

The following results were generated by running the performance test. The resulting output has been converted into a Markdown table for this document and cleaned up. See [here](misc/results.txt) for the original output.

Let's go over the results one by one. *Own* refers to my implementation and *rsa* refers to the rsa module. The three main functions supported my program were benchmarked: key generation, encryption and decryption.

| Name (time in ms)  |               Min |                  Max |               Mean |             StdDev |             Median |                IQR |  Outliers | Rounds |
| :----------------- | ----------------: | -------------------: | -----------------: | -----------------: | -----------------: | -----------------: | --------: | -----: |
| decryption_own     |  3.5010 (96.71)   |     4.0817 (37.03)   |   3.6819 (94.78)   |   0.0723 (9.82)    |   3.6698 (100.76)  |   0.0856 (574.31)  |   80;5    |    276 |
| decryption_rsa     |  1.2789 (35.33)   |     1.6610 (15.07)   |   1.3783 (35.48)   |   0.0538 (7.31)    |   1.3766 (37.80)   |   0.0579 (388.31)  |  178;16   |    550 |
| encryption_own     |  0.0362 (1.0)     |     0.1102 (1.0)     |   0.0388 (1.0)     |   0.0074 (1.0)     |   0.0364 (1.0)     |   0.0001 (1.0)     | 1971;3469 |  18924 |
| encryption_rsa     |  0.0481 (1.33)    |     0.1243 (1.13)    |   0.0522 (1.34)    |   0.0095 (1.29)    |   0.0489 (1.34)    |   0.0005 (3.29)    | 1867;2681 |  14554 |
| key_generation_own | 85.2597 (>1000.0) | 2,757.1133 (>1000.0) | 567.4260 (>1000.0) | 350.2357 (>1000.0) | 485.9986 (>1000.0) | 429.6248 (>1000.0) |  502;70   |   2000 |
| key_generation_rsa | 19.6882 (543.84)  | 3,011.7440 (>1000.0) | 339.4130 (>1000.0) | 259.2769 (>1000.0) | 275.5344 (>1000.0) | 293.3541 (>1000.0) |  413;74   |   2000 |

#### Key generation

Key generation was tested with the same parameters: a key length of 1024 bits and 2000 rounds of testing. Looking at the mean and the median values for the different test runs, my implementation would appear to be slower, almost twice as slow as the rsa module. Based on these results, my implementation of the key generation process could optimized.

#### Encryption

When it comes to encryption, my implementation would appear to be faster. Without looking into the source code of the rsa module, I would assume this is because my program only supports a very limited set of characters, thus it does not take long for the conversion process to take place.

#### Decryption

In the case of decryption however, my implementation runs considerably slower.

## Integration testing

Integration testing has been conducted manually by running and testing the application via the command-line interface. Several flaws were also pointed out in the second peer review and have been since fixed.

## Code quality

The keep track of the quality of the source code, [pylint](https://pypi.org/project/pylint/) is used. To manually check the quality, run the command `poetry run invoke lint`. The linter should have nothing to complain about and the following results should be displayed.

```
user@machine:~/git/rsa$ poetry run invoke lint

--------------------------------------------------------------------
Your code has been rated at 10.00/10 (previous run: 10.00/10, +0.00)
```

The file *.pylintrc* is used to configure pylint.

## Known issues

See [Issues](https://github.com/rikurauhala/rsa/issues) for an up-to-date list.
